{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 700,
  "height": 500,
  "data": {
    "url": "https://raw.githubusercontent.com/danpham02/fit3179/main/data/Emergency-Department-Care-2021-22-visitoutcome.csv",
    "format": {"type": "csv"}
  },
  "transform": [
    {
      "fold": [
        "Admitted to this hospital", 
        "Departed without being admitted or referred", 
        "Referred to another hospital for admission", 
        "Did not wait", 
        "Left at own risk", 
        "Registered, advised of another health care service and left without being attended to"
      ],
      "as": ["Status", "Count"]
    },
    {
      "lookup": "Status",
      "from": {
        "data": {
          "values": [
            {"old": "Admitted to this hospital", "new": "Admitted"},
            {"old": "Departed without being admitted or referred", "new": "Not Admitted"},
            {"old": "Referred to another hospital for admission", "new": "Referred"},
            {"old": "Did not wait", "new": "Did Not Wait"},
            {"old": "Left at own risk", "new": "Left At Own Risk"},
            {"old": "Registered, advised of another health care service and left without being attended to", "new": "Registered & Left"}
          ]
        },
        "key": "old",
        "fields": ["new"]
      },
      "as": ["Status"]
    },
    {
      "lookup": "State",
      "from": {
        "data": {
          "values": [
            {"old": "NSW", "new": "New South Wales"},
            {"old": "Vic", "new": "Victoria"},
            {"old": "Qld", "new": "Queensland"},
            {"old": "WA", "new": "Western Australia"},
            {"old": "SA", "new": "South Australia"},
            {"old": "Tas", "new": "Tasmania"},
            {"old": "ACT", "new": "Australian Capital Territory"},
            {"old": "NT", "new": "Northern Territory"}
          ]
        },
        "key": "old",
        "fields": ["new"]
      },
      "as": ["State"]
    },
    {
      "joinaggregate": [{
        "op": "sum", "field": "Count", "as": "TotalPresentations"
      }],
      "groupby": ["State"]
    },
    {
      "calculate": "datum.Count / datum.TotalPresentations * 100",
      "as": "Percentage"
    }
  ],
  "mark": "bar",
  "encoding": {
    "y": {
      "field": "State",
      "type": "nominal",
      "axis": {"title": "State or Territory"}
    },
    "x": {
      "field": "Percentage",
      "type": "quantitative",
      "axis": {"title": "Percentage of Presentations (%)", "max": 100},
      "scale": {"domain": [0, 100]}
    },
    "color": {
      "field": "Status",
      "type": "nominal",
      "legend": {"title": "Emergency Department Status"},
      "scale": {
        "range": [
          "#66c2a5", "#fc8d62", "#8da0cb", "#e78ac3", "#a6d854", "#ffd92f", "#e5c494"
        ]
      }
    },
    "tooltip": [
      {"field": "State", "type": "nominal", "title": "State"},
      {"field": "Status", "type": "nominal", "title": "Status"},
      {"field": "Percentage", "type": "quantitative", "title": "Percentage (%)"}
    ]
  },
  "title": {
    "text": "Normalized Emergency Department Presentations by Status",
    "subtitle": "Across States and Territories (2021-22)",
    "fontSize": 16,
    "fontWeight": "bold",
    "anchor": "middle"
  }
}
